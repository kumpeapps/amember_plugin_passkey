<!DOCTYPE html>
<html>
<head>
    <title>Test Login Page</title>
</head>
<body>
    <h1>Test Login Page</h1>
    <form action="/login" method="post">
        <div>
            <label>Username:</label>
            <input type="text" name="username" required>
        </div>
        <div>
            <label>Password:</label>
            <input type="password" name="password" required>
        </div>
        <button type="submit">Login</button>
    </form>

    <script>
        // Simulate the passkey UI injection JavaScript from the plugin
        console.log("Testing passkey UI injection");
        
        function passkeyLogin() {
            console.log("Passkey login function called");
            alert("Passkey login would be called here");
        }
        
        // Inject the same UI logic as the plugin
        function injectPasskeyUI() {
            console.log("injectPasskeyUI called");
            
            if (document.getElementById("passkey-login-container")) {
                console.log("UI already exists, skipping injection");
                return;
            }
            
            var targetElements = [
                document.querySelector("input[type=password]")?.closest("form"),
                document.querySelector("form"),
                document.querySelector(".login-form"),
                document.querySelector("#login-form"),
                document.querySelector(".user-login"),
                document.querySelector("#user-login"),
                document.querySelector("body")
            ];
            
            var targetElement = null;
            for (var i = 0; i < targetElements.length; i++) {
                if (targetElements[i]) {
                    targetElement = targetElements[i];
                    console.log("Found target element #" + i + ":", targetElement.tagName, targetElement.className || targetElement.id || "no class/id");
                    break;
                }
            }
            
            if (!targetElement) {
                console.log("No suitable target element found, using prominent fallback");
                var fallbackDiv = document.createElement("div");
                fallbackDiv.id = "passkey-floating-login";
                fallbackDiv.style.cssText = "position: fixed; top: 50px; right: 20px; z-index: 99999; background: #ffffff; border: 3px solid #007cba; border-radius: 12px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); max-width: 320px; font-family: Arial, sans-serif;";
                fallbackDiv.innerHTML = '<div style="margin-bottom: 15px; font-weight: bold; color: #007cba; font-size: 16px; text-align: center;">üîê Secure Passkey Login</div><p style="margin: 0 0 15px 0; color: #333; font-size: 14px; line-height: 1.4;">Use your device\'s built-in security (Touch ID, Face ID, etc.) for instant, secure login.</p><button type="button" onclick="passkeyLogin()" style="background:#007cba;color:white;padding:12px 20px;border:none;border-radius:6px;cursor:pointer;width:100%;margin-bottom:10px;font-size: 16px;font-weight:bold;">üöÄ Login with Passkey</button><div id="passkey-login-status" style="font-size:13px;color:#666;min-height:20px;text-align:center;"></div><button onclick="this.parentNode.remove()" style="position: absolute; top: 8px; right: 12px; background: none; border: none; color: #999; cursor: pointer; font-size: 18px; font-weight: bold;" title="Close">√ó</button>';
                document.body.appendChild(fallbackDiv);
                console.log("Added prominent floating fallback UI");
                
                var anyForm = document.querySelector("form");
                if (anyForm) {
                    var inlineDiv = document.createElement("div");
                    inlineDiv.style.cssText = "margin: 15px 0; padding: 15px; background: #f0f8ff; border: 2px solid #007cba; border-radius: 8px;";
                    inlineDiv.innerHTML = '<div style="margin-bottom: 10px; font-weight: bold; color: #007cba;">üîê Alternative Login Method</div><button type="button" onclick="passkeyLogin()" style="background:#28a745;color:white;padding:10px 16px;border:none;border-radius:4px;cursor:pointer;">Login with Passkey</button>';
                    anyForm.parentNode.insertBefore(inlineDiv, anyForm);
                    console.log("Added inline backup UI near form");
                }
                return;
            }
        }
        
        // Call the injection when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', injectPasskeyUI);
        } else {
            injectPasskeyUI();
        }
    </script>
</body>
</html>
