<!DOCTYPE html>
<html lang="en">
<head>
    <meta charse        <h4>Required Database Table: <code>am_api_key</code></h4>
        <p>Your API key needs an entry with BOTH permissions:</p>
        <pre>UPDATE am_api_key 
SET perms = '{"check-access":{"by-login-pass":1,"post":1}}' 
WHERE `key` = 'U0ZW8TJru85iAmzwGGd9';</pre>

        <h4>Alternative: Complete INSERT if needed:</h4>
        <pre>INSERT INTO am_api_key (
    `key`, 
    `perms`, 
    `is_disabled`, 
    `name`
) VALUES (
    'U0ZW8TJru85iAmzwGGd9',
    '{"check-access":{"by-login-pass":1,"post":1}}',
    0,
    'Passkey Authentication Test Key'
);</pre>   <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Key Setup Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .diagnostic-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; background: #f9f9f9; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; white-space: pre-wrap; }
        .code { background: #e8e8e8; padding: 2px 6px; font-family: monospace; }
        ul { margin: 10px 0; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üîß API Key Setup Diagnostic</h1>
    
    <div class="diagnostic-section">
        <h2>üìä Current Status</h2>
        <p class="warning">‚ö†Ô∏è API Error 10003 - no permissions for check-access-post API call</p>
        <p><strong>Progress:</strong> ‚úÖ API key found and enabled ‚Üí ‚ùå Missing required permissions</p>
        <p>Your API key <code>U0ZW8TJru85iAmzwGGd9</code> is now in the database but needs additional permissions.</p>
        
        <h3>üéØ Required Permissions</h3>
        <p>For the passkey authentication endpoint to work, your API key needs:</p>
        <ul>
            <li>‚úÖ <code>by-login-pass</code> - Basic authentication permission</li>
            <li>‚ùå <code>check-access-post</code> - Permission for POST requests to check-access endpoint</li>
        </ul>
    </div>

    <div class="diagnostic-section">
        <h2>üîç How to Fix This</h2>
        
        <h3>Option 1: aMember Admin Panel - Try These Permissions</h3>
        <p><strong>Issue:</strong> The admin panel doesn't show a "post" option under check-access.</p>
        <p><strong>Try these alternatives in your API key permissions:</strong></p>
        <ol>
            <li>Look for <strong>check-access</strong> (general) - enable ALL sub-options available</li>
            <li>Look for <strong>check-access-by-login-pass</strong> (specific method)</li>
            <li>Look for <strong>check-access-by-*</strong> (any related options)</li>
            <li>Try enabling <strong>ALL check-access permissions</strong> available in the dropdown</li>
            <li>If available, try adding <strong>general API access</strong> or <strong>full API</strong> permissions</li>
        </ol>
        
        <h4>üìã What to Look For in Admin Panel:</h4>
        <ul>
            <li>‚úÖ check-access ‚Üí by-login-pass (you have this)</li>
            <li>‚ùì check-access ‚Üí by-* (any other options)</li>
            <li>‚ùì check-access ‚Üí * (any general options)</li>
            <li>‚ùì api ‚Üí * (general API permissions)</li>
        </ul>
        
                <h3>Option 2: Database Setup - Try Different Permission Formats</h3>
        <p>Since the admin panel doesn't have "post", try these database updates:</p>
        
        <h4>Try #1: Add general check-access permission</h4>
        <pre>UPDATE am_api_key 
SET perms = '{"check-access":{"by-login-pass":1,"*":1}}' 
WHERE `key` = 'U0ZW8TJru85iAmzwGGd9';</pre>

        <h4>Try #2: Add broader API permissions</h4>
        <pre>UPDATE am_api_key 
SET perms = '{"check-access":1,"api":1}' 
WHERE `key` = 'U0ZW8TJru85iAmzwGGd9';</pre>

        <h4>Try #3: Use comma-separated format with multiple permissions</h4>
        <pre>UPDATE am_api_key 
SET perms = 'check-access,by-login-pass,api' 
WHERE `key` = 'U0ZW8TJru85iAmzwGGd9';</pre>

        <h4>Try #4: Full access (for testing)</h4>
        <pre>UPDATE am_api_key 
SET perms = '*' 
WHERE `key` = 'U0ZW8TJru85iAmzwGGd9';</pre>
    </div>

    <div class="diagnostic-section">
        <h2>ÔøΩ Troubleshooting Steps</h2>
        
        <h3>Step 1: Check Available Permissions in Admin Panel</h3>
        <ol>
            <li>Go to your aMember admin ‚Üí Setup/Configuration ‚Üí API Keys</li>
            <li>Edit your key <code>U0ZW8TJru85iAmzwGGd9</code></li>
            <li>Take a screenshot of ALL available permission options</li>
            <li>Look specifically for anything containing:
                <ul>
                    <li><code>check-access</code></li>
                    <li><code>api</code></li>
                    <li><code>post</code></li>
                    <li><code>*</code> (wildcard/all)</li>
                </ul>
            </li>
        </ol>
        
        <h3>Step 2: Try Full Permissions (Testing)</h3>
        <p>As a test, try enabling <strong>ALL</strong> available permissions for this API key to see if that resolves the issue.</p>
        
        <h3>Step 3: Alternative - Bypass aMember API System</h3>
        <p>If the permission issue persists, we might need to modify the plugin to handle the authentication differently or bypass aMember's standard API permission system for this specific endpoint.</p>
    </div>

    <div class="diagnostic-section">
        <h2>üöÄ Next Steps</h2>
        <ol>
            <li><strong>Try the admin panel solutions above</strong> - enable ALL available check-access permissions</li>
            <li><strong>Or try the database updates</strong> - start with Try #4 (full access) for testing</li>
            <li><strong>Test again</strong> by refreshing the API test page</li>
            <li>If still getting permission errors, we may need to modify the plugin approach</li>
        </ol>
        
        <p class="info">üí° <strong>Expected Next Result:</strong> Once the permission issue is resolved, you should see errors related to the actual passkey validation rather than API permission errors.</p>
    </div>

    <div class="diagnostic-section">
        <h2>üìù Debug Information</h2>
        <p>The plugin logs detailed information about API key validation. Check your error logs for entries like:</p>
        <ul>
            <li><code>Passkey Plugin: checkApiPermission - Looking up key: U0ZW8TJru8...</code></li>
            <li><code>Passkey Plugin: checkApiPermission - API key not found in database</code></li>
            <li><code>Passkey Plugin: checkApiPermission - Key permissions: ...</code></li>
            <li><code>Passkey Plugin: checkApiPermission - Final result: ...</code></li>
        </ul>
        <p>These logs will help you understand exactly what's happening with your API key validation.</p>
    </div>

    <div class="diagnostic-section">
        <h2>üîÑ Return to Tests</h2>
        <p><a href="test_api_fix.html">‚Üê Back to API Authentication Tests</a></p>
    </div>
</body>
</html>
